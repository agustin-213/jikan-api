<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Spotify API Demo</title>
  <style>
    body {
      background: linear-gradient(180deg, rgb(163, 2, 2), rgb(238, 38, 2), rgb(156, 2, 2));
      background-size: 100% 300%;
      animation: gradientAnimation 8s ease infinite;
    }
  
    @keyframes gradientAnimation {
      0% { background-position: 0% 0%; }
      50% { background-position: 0% 100%; }
      100% { background-position: 0% 0%; }
    }
  </style>
  
</head>
<body>
  <h1>üéß Spotify API Demo</h1>
  <button id="login">Iniciar sesi√≥n con Spotify</button>
  <button id="getData" style="display:none;">Ver mis artistas top</button>
  <pre id="output"></pre>

 <script>
    // ‚ö° Configuraci√≥n
    const client_id = "TU_CLIENT_ID"; // üëâ Pega aqu√≠ tu Client ID
    const redirect_uri = "http://localhost:5500/index.html"; // Debe coincidir EXACTO
    const scopes = "user-top-read";

    // üëâ Funci√≥n para armar la URL de login
    function login() {
      const authUrl = "https://accounts.spotify.com/authorize?" + new URLSearchParams({
        response_type: "token",   // üëà token, no code
        client_id: client_id,
        scope: scopes,
        redirect_uri: redirect_uri
      });
      window.location.href = authUrl;
    }

    document.getElementById("login").onclick = login;

    // üëâ Captura el token desde el hash de la URL
    function getTokenFromUrl() {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      const token = params.get("access_token");
      const expiresIn = params.get("expires_in");
      if (token && expiresIn) {
        const expirationTime = Date.now() + Number(expiresIn) * 1000;
        localStorage.setItem("spotify_token", token);
        localStorage.setItem("spotify_expiration", expirationTime);
        window.location.hash = ""; // limpiar la URL
        return token;
      }
      return null;
    }

    // üëâ Recuperar token si existe y no venci√≥
    function getStoredToken() {
      const token = localStorage.getItem("spotify_token");
      const expiration = localStorage.getItem("spotify_expiration");
      if (!token || !expiration) return null;

      if (Date.now() > Number(expiration)) {
        // ‚ö° Token vencido ‚Üí pedir login otra vez
        localStorage.removeItem("spotify_token");
        localStorage.removeItem("spotify_expiration");
        login();
        return null;
      }
      return token;
    }

    // Procesar URL despu√©s del login
    let token = getTokenFromUrl() || getStoredToken();

    if (token) {
      document.getElementById("login").style.display = "none";
      document.getElementById("getData").style.display = "inline-block";
    }

    // üëâ Bot√≥n para pedir datos
    document.getElementById("getData").onclick = async () => {
      const out = document.getElementById("output");
      out.textContent = "Cargando...";

      try {
        const res = await fetch("https://api.spotify.com/v1/me/top/artists", {
          headers: { Authorization: "Bearer " + token }
        });

        if (!res.ok) {
          throw new Error("Error HTTP " + res.status);
        }

        const data = await res.json();
        out.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        out.textContent = "‚ùå Error: " + e.message;
      }
    };
  </script>
</body>
</html>
