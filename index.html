<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üìö Cat√°logo Anime & Manga</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: radial-gradient(circle at top, #1a1a1a, #0c0c0c);
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      width: 100%;
      background: #a81414;
      text-align: center;
      padding: 20px;
      font-size: 28px;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }

    .buscador {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .buscador input {
      padding: 10px 15px;
      border-radius: 10px;
      border: none;
      width: 250px;
      font-size: 16px;
      background: #2a2a2a;
      color: #fff;
    }

    .buscador input::placeholder {
      color: #aaa;
    }

    .buscador button {
      background: #a81414;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .buscador button:hover {
      background: #8c0f0f;
    }

    .historial {
      background: #1b1b1b;
      border-radius: 15px;
      padding: 15px;
      margin: 20px auto;
      max-width: 600px;
      text-align: center;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }

    .historial h3 {
      color: #d15d5d;
    }

    .historial button {
      margin-top: 5px;
      background: #8c0f0f;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
    }

    .historial button:hover {
      background: #a33030;
    }

    .historial-lista {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }

    .historial-item {
      background: #252525;
      padding: 6px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      color: #ffbaba;
      transition: background 0.3s;
    }

    .historial-item:hover {
      background: #3a1c1c;
    }

    .contenedor {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 25px;
      padding: 40px;
      max-width: 1200px;
      width: 100%;
    }

    .anime-card {
      background: #1b1b1b;
      border-radius: 15px;
      overflow: hidden;
      text-align: center;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }

    .anime-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 20px rgba(168, 35, 35, 0.6);
    }

    .anime-card img {
      width: 100%;
      height: 320px;
      object-fit: cover;
    }

    .info {
      padding: 10px 15px 20px;
    }

    .titulo {
      font-weight: bold;
      font-size: 17px;
      margin-bottom: 5px;
      color: #fc7a7a;
    }

    .puntuacion {
      color: #ffce52;
      margin-bottom: 5px;
    }

    #detalle {
      display: none;
      text-align: center;
      max-width: 900px;
      margin: 40px auto;
      background: #161616;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 0 25px rgba(0,0,0,0.5);
    }

    #detalle h2 {
      color: #ff6b6b;
    }

    #detalle img {
      border-radius: 10px;
      margin: 10px;
      width: 180px;
      height: 260px;
      object-fit: cover;
    }

    #detalle iframe {
      width: 100%;
      height: 400px;
      border-radius: 15px;
      margin-top: 25px;
    }

    #volver {
      background: #b52020;
      color: #fff;
      border: none;
      padding: 12px 25px;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
      margin-bottom: 25px;
      transition: background 0.3s;
    }

    #volver:hover {
      background: #901a1a;
    }

    footer {
      text-align: center;
      padding: 20px;
      color: #888;
      background: #111;
      width: 100%;
      margin-top: 30px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>üìö Cat√°logo de Animes y Mangas</header>

  <div class="buscador">
    <input type="text" id="busqueda" placeholder="Buscar anime o manga...">
    <button onclick="buscarAnime()">Buscar</button>
  </div>

  <div class="historial">
    <h3>üïí Historial de b√∫squedas</h3>
    <div id="historialLista" class="historial-lista"></div>
    <button onclick="borrarHistorial()">Borrar historial</button>
  </div>

  <div id="contenedor" class="contenedor"></div>

  <div id="detalle">
    <button id="volver" onclick="volverAlCatalogo()">‚¨Ö Volver</button>
    <div id="contenidoDetalle"></div>
  </div>

  <footer>Datos obtenidos de Jikan API / MyAnimeList ¬∑ Creado por Agus</footer>

  <script>
    function guardarEnHistorial(termino) {
      let historial = JSON.parse(localStorage.getItem('historial')) || [];
      if (!historial.includes(termino)) {
        historial.unshift(termino);
        if (historial.length > 10) historial.pop();
        localStorage.setItem('historial', JSON.stringify(historial));
      }
      mostrarHistorial();
    }

    function mostrarHistorial() {
      const historial = JSON.parse(localStorage.getItem('historial')) || [];
      const contenedor = document.getElementById('historialLista');
      contenedor.innerHTML = historial.map(t => `<div class="historial-item" onclick="buscarAnime('${t}')">${t}</div>`).join('');
    }

    function borrarHistorial() {
      localStorage.removeItem('historial');
      mostrarHistorial();
    }

    async function cargarAnimes() {
      const contenedor = document.getElementById('contenedor');
      contenedor.innerHTML = "<p style='grid-column:1/-1;text-align:center;'>Cargando animes...</p>";

      try {
        const res = await fetch("https://api.jikan.moe/v4/seasons/now");
        const data = await res.json();
        const animes = data.data;
        contenedor.innerHTML = "";

        animes.forEach(anime => {
          const card = document.createElement('div');
          card.className = 'anime-card';
          card.innerHTML = `
            <img src="${anime.images.jpg.image_url}" alt="${anime.title}">
            <div class="info">
              <div class="titulo">${anime.title}</div>
              <div class="puntuacion">‚≠ê ${anime.score || "N/A"}</div>
              <small>${anime.type || "Desconocido"} ¬∑ ${anime.year || "A√±o desconocido"}</small>
            </div>
          `;
          card.onclick = () => mostrarDetalle(anime.mal_id, anime.title);
          contenedor.appendChild(card);
        });
      } catch {
        contenedor.innerHTML = "<p style='color:red;'>Error al cargar los animes üò¢</p>";
      }
    }

    async function buscarAnime(termino) {
      const contenedor = document.getElementById('contenedor');
      const input = document.getElementById('busqueda');
      const query = termino || input.value.trim();
      if (!query) return alert("Escribe algo para buscar");

      guardarEnHistorial(query);
      contenedor.innerHTML = `<p style='grid-column:1/-1;text-align:center;'>Buscando "${query}"...</p>`;

      try {
        const res = await fetch(`https://api.jikan.moe/v4/anime?q=${encodeURIComponent(query)}&limit=20`);
        const data = await res.json();
        const animes = data.data;
        contenedor.innerHTML = "";

        if (animes.length === 0) {
          contenedor.innerHTML = "<p style='text-align:center;'>No se encontr√≥ ning√∫n resultado üò¢</p>";
          return;
        }

        animes.forEach(anime => {
          const card = document.createElement('div');
          card.className = 'anime-card';
          card.innerHTML = `
            <img src="${anime.images.jpg.image_url}" alt="${anime.title}">
            <div class="info">
              <div class="titulo">${anime.title}</div>
              <div class="puntuacion">‚≠ê ${anime.score || "N/A"}</div>
              <small>${anime.type || "Desconocido"} ¬∑ ${anime.year || "A√±o desconocido"}</small>
            </div>
          `;
          card.onclick = () => mostrarDetalle(anime.mal_id, anime.title);
          contenedor.appendChild(card);
        });
      } catch {
        contenedor.innerHTML = "<p style='color:red;'>Error al buscar üò¢</p>";
      }
    }

    async function mostrarDetalle(id, titulo) {
      const contenedor = document.getElementById('contenedor');
      const detalle = document.getElementById('detalle');
      const contenido = document.getElementById('contenidoDetalle');

      contenedor.style.display = 'none';
      detalle.style.display = 'block';
      contenido.innerHTML = "<p>Cargando informaci√≥n...</p>";

      try {
        const res = await fetch(`https://api.jikan.moe/v4/anime/${id}/full`);
        const data = await res.json();
        const anime = data.data;

        let trailerHTML = anime.trailer && anime.trailer.embed_url
          ? `<iframe src="${anime.trailer.embed_url}" allowfullscreen></iframe>`
          : "<p>No hay tr√°iler disponible üé•</p>";

        const mangaRes = await fetch(`https://api.jikan.moe/v4/manga?q=${encodeURIComponent(titulo)}&limit=3`);
        const mangaData = await mangaRes.json();
        const mangas = mangaData.data;

        let imagenesHTML = "";
        mangas.forEach(m => {
          if (m.images && m.images.jpg.image_url) {
            imagenesHTML += `<img src="${m.images.jpg.image_url}" alt="${m.title}">`;
          }
        });

        contenido.innerHTML = `
          <h2>${anime.title}</h2>
          <p><strong>Puntuaci√≥n:</strong> ${anime.score || "N/A"} ‚≠ê</p>
          <p><strong>Episodios:</strong> ${anime.episodes || "?"}</p>
          <p><strong>G√©neros:</strong> ${anime.genres.map(g => g.name).join(", ")}</p>
          <p><strong>A√±o:</strong> ${anime.year || "Desconocido"}</p>
          <p>${anime.synopsis || "Sin descripci√≥n disponible."}</p>
          <h3>üñºÔ∏è Im√°genes de los tomos del manga</h3>
          <div>${imagenesHTML || "<p>No se encontraron im√°genes de manga üìö</p>"}</div>
          <h3>üé• Tr√°iler oficial</h3>
          ${trailerHTML}
        `;
      } catch {
        contenido.innerHTML = "<p style='color:red;'>Error al cargar el detalle üò¢</p>";
      }
    }

    function volverAlCatalogo() {
      document.getElementById('detalle').style.display = 'none';
      document.getElementById('contenedor').style.display = 'grid';
    }

    cargarAnimes();
    mostrarHistorial();
  </script>
</body>
</html>
